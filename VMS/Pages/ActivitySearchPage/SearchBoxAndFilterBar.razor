@inject IJSRuntime JSRuntime
<div class="heading-container">
    <h3 class="mt-5 mb-4 text-uppercase page-heading">We do it <span>together!</span></h3>
    <form action="/" method="post" class="my-search-box d-flex mb-5">
        <input type="text" value=@mySearchValue @oninput="UpdateInstanceValue" class="my-search-box__input" placeholder="Tìm kiếm bằng từ khóa" />
        <div class="my-search-box__icon-wrapper d-flex align-items-center">
            <span @onclick="ClearSearchBox" class="material-icons-outlined clear-search-btn">
                close
            </span>
            <button type="submit" class="search-btn d-flex align-items-center">
                <span class="material-icons-outlined">
                    search
                </span>
            </button>
        </div>
    </form>
</div>

<div class="d-flex align-items-center mb-3">
    <div class="form-check form-check-inline d-flex align-items-center ps-0 pe-5">
        <input class="my-check-box cursor-pointer" type="checkbox" id="virtual" value="virtual">
        <label class="my-check-box-label cursor-pointer" for="virtual">Virtual</label>
    </div>
    <div class="form-check form-check-inline d-flex align-items-center ps-0 pe-5">
        <input class="my-check-box cursor-pointer" type="checkbox" id="actual" value="actual">
        <label class="my-check-box-label cursor-pointer" for="actual">Actual</label>
    </div>
    <div class="form-check form-check-inline d-flex align-items-center p-0">
        <input class="my-check-box cursor-pointer" type="checkbox" id="covid-19" value="actual">
        <label class="my-check-box-label cursor-pointer colored-red" for="covid-19">COVID-19
            <svg aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 512 512"><path d="M224 192a16 16 0 1 0 16 16a16 16 0 0 0-16-16zM466.5 83.68l-192-80A57.4 57.4 0 0 0 256.05 0a57.4 57.4 0 0 0-18.46 3.67l-192 80A47.93 47.93 0 0 0 16 128c0 198.5 114.5 335.72 221.5 380.32a48.09 48.09 0 0 0 36.91 0C360.09 472.61 496 349.3 496 128a48 48 0 0 0-29.5-44.32zM384 256h-12.12c-28.51 0-42.79 34.47-22.63 54.63l8.58 8.57a16 16 0 1 1-22.63 22.63l-8.57-8.58c-20.16-20.16-54.63-5.88-54.63 22.63V368a16 16 0 0 1-32 0v-12.12c0-28.51-34.47-42.79-54.63-22.63l-8.57 8.58a16 16 0 0 1-22.63-22.63l8.58-8.57c20.16-20.16 5.88-54.63-22.63-54.63H128a16 16 0 0 1 0-32h12.12c28.51 0 42.79-34.47 22.63-54.63l-8.58-8.57a16 16 0 0 1 22.63-22.63l8.57 8.58c20.16 20.16 54.63 5.88 54.63-22.63V112a16 16 0 0 1 32 0v12.12c0 28.51 34.47 42.79 54.63 22.63l8.57-8.58a16 16 0 0 1 22.63 22.63l-8.58 8.57c-20.16 20.16-5.88 54.63 22.63 54.63H384a16 16 0 0 1 0 32zm-96 0a16 16 0 1 0 16 16a16 16 0 0 0-16-16z" fill="currentColor" /></svg>
        </label>
    </div>
</div>

<form class="filter-bar d-flex justify-content-between mb-5">
    <div class="filter-item filter-item-city position-relative">
        <input @onclick="ToggleCityDropdown" @onfocusout="CloseCityDropdown" class="popup-btn @(haveCityValue?"bg-grey":"")" placeholder="@cityChoosenValue" readonly>
        <div @onclick:preventDefault class="my-dropdown" style="display: @(isCityShow ? "block" : "none")">
            <ul>
                @for (int i = 0; i < 10; i++)
                {
                    int id = i;
                    <li @onmousedown="() => ChooseCityValue(id)">@nameCityValue @(id + 1)</li>
                }
            </ul>
        </div>
        <span class="material-icons-outlined position-absolute filter-item__icon">
            expand_more
        </span>
    </div>

    <div class="filter-item filter-item-district position-relative">
        <input @onclick="ToggleDistrictDropdown" @onfocusout="CloseDistrictDropdown" class="popup-btn @(haveDistrictValue?"bg-grey":"")" placeholder="@districtChoosenValue" readonly>
        <div class="my-dropdown" style="display: @(isDistrictShow ? "block" : "none")">
            <ul>
                @for (int i = 0; i < 10; i++)
                {
                    int id = i;
                    <li @onmousedown="() => ChooseDistrictValue(id)">@nameDistrictValue @(id + 1)</li>
                }
            </ul>
        </div>
        <span class="material-icons-outlined position-absolute filter-item__icon">
            expand_more
        </span>
    </div>

    <div class="filter-item filter-item-organization position-relative">
        <input @onclick="ToggleOrganizationDropdown" @onfocusout="CloseOrganizationDropdown" class="popup-btn @(haveOrganizationValue?"bg-grey":"")" placeholder="@organizationChoosenValue" readonly>
        <div class="my-dropdown" style="display: @(isOrganizationShow ? "block" : "none")">
            <ul>
                @for (int i = 0; i < 10; i++)
                {
                    int id = i;
                    <li @onmousedown="() => ChooseOrganizationValue(id)">@nameOrganizationValue @(id + 1)</li>
                }
            </ul>
        </div>
        <span class="material-icons-outlined position-absolute filter-item__icon">
            expand_more
        </span>
    </div>

    <div class="filter-item position-relative">
        <div @onclick="ShowAreasPopup" class="popup-btn @(haveAreasValue?"bg-grey":"")">Lĩnh vực</div>
        <span class="material-icons-outlined position-absolute filter-item__icon">
            expand_more
        </span>
    </div>

    <div class="filter-item position-relative">
        <div @onclick="ShowSkillsPopup" class="popup-btn @(haveSkillsValue?"bg-grey":"")">Kỹ năng</div>
        <span class="material-icons-outlined position-absolute filter-item__icon">
            expand_more
        </span>
    </div>

    <button type="submit" class="filter-btn">Lọc</button>
    <button @onclick="ClearFilter" type="button" class="clear-filter-btn">Xóa lọc</button>
</form>


<div class="arrange-bar d-flex align-items-center">
    <label class="d-inline-block m-0 me-5">Sắp xếp theo</label>
    <div class="d-flex align-items-center ps-0 pe-5">
        <input class="my-radio-box cursor-pointer" type="checkbox" id="newest" value="newest">
        <label class="my-radio-box-label cursor-pointer" for="newest">Mới nhất</label>
    </div>
    <div class="d-flex align-items-center ps-0 pe-5">
        <input class="my-radio-box cursor-pointer" type="checkbox" id="nearest" value="nearest">
        <label class="my-radio-box-label cursor-pointer" for="nearest">Gần bạn nhất</label>
    </div>
    <div class="d-flex align-items-center ps-0 pe-5">
        <input class="my-radio-box cursor-pointer" type="checkbox" id="common" value="common">
        <label class="my-radio-box-label cursor-pointer" for="common">Nổi bật nhất</label>
    </div>
</div>


@code {
    bool isCityShow = false;
    bool haveCityValue = false;
    bool isDistrictShow = false;
    bool haveDistrictValue = false;
    bool isOrganizationShow = false;
    bool haveOrganizationValue = false;
    bool haveAreasValue = false;
    bool haveSkillsValue = false;

    string cityChoosenValue = "Tỉnh/Thành phố";
    string districtChoosenValue = "Quận/Huyện";
    string organizationChoosenValue = "Tổ chức";

    string nameCityValue = "Hồ Chí Minh";
    string nameDistrictValue = "Quận Thủ Đức";
    string nameOrganizationValue = "Hội đồng đồ ăn xuyên Việt";
    string mySearchValue = "";

    int areasItems = 13;

    //function for city dropdowns
    void ToggleCityDropdown()
    {
        isCityShow = !isCityShow;
    }
    void CloseCityDropdown()
    {
        isCityShow = false;
    }
    void ChooseCityValue(int id)
    {
        cityChoosenValue = nameCityValue + " " + (id + 1).ToString();
        haveCityValue = true;
    }

    //function for district dropdowns
    void ToggleDistrictDropdown()
    {
        isDistrictShow = !isDistrictShow;
    }
    void CloseDistrictDropdown()
    {
        isDistrictShow = false;
    }
    void ChooseDistrictValue(int id)
    {
        districtChoosenValue = nameDistrictValue + " " + (id + 1).ToString();
        haveDistrictValue = true;
    }

    //function for organization dropdowns
    void ToggleOrganizationDropdown()
    {
        isOrganizationShow = !isOrganizationShow;
    }
    void CloseOrganizationDropdown()
    {
        isOrganizationShow = false;
    }
    void ChooseOrganizationValue(int id)
    {
        organizationChoosenValue = nameOrganizationValue + " " + (id + 1).ToString();
        haveOrganizationValue = true;
    }

    void CloseDropdown()
    {
        isCityShow = false;
        isDistrictShow = false;
        isOrganizationShow = false;
    }

    //Clear search box button
    void UpdateInstanceValue(ChangeEventArgs e)
    {
        mySearchValue = e.Value.ToString();
    }
    void ClearSearchBox()
    {
        mySearchValue = "";
    }

    void CheckBackgroundOfAreaAndSkills()
    {
        haveAreasValue = false;
        haveSkillsValue = false;
        for (int i = 0; i < areasItems; i++)
        {
            if (choosenAreasList[i])
            {
                haveAreasValue = true;
            }
        }

        for (int i = 0; i < 15; i++)
        {
            for (int j = 0; j < 11; j++)
            {
                if (choosenSkillsList[i, j])
                {
                    haveSkillsValue = true;
                }
            }
        }
    }

    bool[] choosenAreasList = new bool[13]; //areasItems = 13

    [CascadingParameter] public IModalService Modal { get; set; }
    async Task ShowAreasPopup()
    {
        isCityShow = false;
        isDistrictShow = false;
        isOrganizationShow = false;
        var options = new ModalOptions()
        {
            HideCloseButton = true,
            DisableBackgroundCancel = true,
            UseCustomLayout = true
        };
        var areasParameter = new ModalParameters();
        areasParameter.Add("choosenAreasList", choosenAreasList);
        var areasModal = Modal.Show<AreasPopup>("", areasParameter, options);
        await areasModal.Result;
        CheckBackgroundOfAreaAndSkills();
    }

    bool[,] choosenSkillsList = new bool[15,11];

    async Task ShowSkillsPopup()
    {
        isCityShow = false;
        isDistrictShow = false;
        isOrganizationShow = false;
        var options = new ModalOptions()
        {
            HideCloseButton = true,
            DisableBackgroundCancel = true,
            UseCustomLayout = true
        };
        var skillsParameter = new ModalParameters();
        skillsParameter.Add("choosenSkillsList", choosenSkillsList);
        var skillsModal = Modal.Show<SkillsPopup>("", skillsParameter, options);
        await skillsModal.Result;
        CheckBackgroundOfAreaAndSkills();
    }

    //clear filter bar
    void ClearFilter()
    {
        cityChoosenValue = "Tỉnh/Thành phố";
        districtChoosenValue = "Quận/Huyện";
        organizationChoosenValue = "Tổ chức";
        choosenAreasList = new bool[13]; //areasItems = 13
        choosenSkillsList = new bool[15, 11];
        haveCityValue = haveDistrictValue = haveOrganizationValue = haveAreasValue = haveSkillsValue = false;
    }
}
